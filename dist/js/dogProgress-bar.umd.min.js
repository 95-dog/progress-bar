!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).DogProgressBar=t()}(this,(function(){"use strict";return class{constructor(e,t){if(this.options={height:"10px",width:"100%",horizontal:!0,moveBtnPercentage:0,moveBtnRadius:"15px",step:1,handleProgressChange:()=>{}},this.isDragging=!1,this.moveBtnSelect=!1,this.isMobile=!1,this.init=()=>{this.mobile(),this.element.classList.add("dog-progress"),this.horizontal||this.element.classList.add("progress-vertical");let e=this.element;e.style.height=this.element.getAttribute("data-dogProgress-height")??this.options.height,e.style.width=this.element.getAttribute("data-dogProgress-width")??this.options.width,e.style.borderRadius=this.element.clientHeight/2+"px",e.addEventListener("click",(e=>{this.updateMoveBarWidthAndMoveBtnLeft(this.horizontal?e.clientX:e.clientY)})),this.buildMoveBar(),this.element.addEventListener("positionChange",this.options.handleProgressChange),window.addEventListener("resize",(()=>{this.updateAddEventListenerStart()}))},this.mobile=()=>{/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(this.isMobile=!0,this.element.classList.add("isMobile")):(this.isMobile=!1,this.element.classList.remove("isMobile"))},this.addKeyboardListeners=()=>{this.removeKeyboardListeners(),document.addEventListener("keydown",this.handleKeyboardNavigation)},this.removeKeyboardListeners=()=>{document.removeEventListener("keydown",this.handleKeyboardNavigation)},this.handleKeyboardNavigation=e=>{let t,i,s=this.element.getBoundingClientRect(),o=this.moveBar.getBoundingClientRect();this.horizontal?(t=this.options.step/100*s.width,"ArrowLeft"===e.key&&(i=Math.max(0,o.width-t)+s.left),"ArrowRight"===e.key&&(i=Math.min(s.width,o.width+t)+s.left),this.updateMoveBarWidthAndMoveBtnLeft(i)):(t=this.options.step/100*s.height,"ArrowUp"===e.key?i=s.top+(s.height-(o.height+t)):"ArrowDown"===e.key&&(i=s.top+(s.height-(o.height-t))),this.updateMoveBarWidthAndMoveBtnLeft(i))},this.showMoveBtn=()=>{this.moveBtn.style.visibility="unset",this.moveBtn.style.opacity="1"},this.hideMovBtn=()=>{this.moveBtnSelect||(this.moveBtn.style.visibility="hidden",this.moveBtn.style.opacity="0")},this.bindPositionChange=()=>{let e=this.horizontal?"width":"height",t=new CustomEvent("positionChange",{detail:{percentage:+(this.moveBar.getBoundingClientRect()[e]/this.element.getBoundingClientRect()[e]).toFixed(2)}});this.element.dispatchEvent(t)},this.buildMoveBar=()=>{let e=document.createElement("div"),t=this.horizontal?"width":"height",i=+this.element.getAttribute("data-dogProgress-value")||this.options.moveBtnPercentage;if(e.classList.add("move-bar"),"number"==typeof i){if(i<0||i>1)throw new Error("moveBtnPercentage的值为0-1之间");e.style[t]=100*i+"%"}e.style.borderRadius=this.element.clientHeight/2+"px",this.element.append(e),this.moveBar=e,this.buildMoveBtn()},this.buildMoveBtn=()=>{let e=document.createElement("div"),t=this.horizontal?"right":"top";e.classList.add("move-btn"),e.style.height=this.options.moveBtnRadius,e.style.width=this.options.moveBtnRadius,this.moveBar.append(e),e.style[t]=`-${e.offsetWidth/2}px`,this.moveBtn=e,this.addEventListenerStart()},this.updateAddEventListenerStart=()=>{this.mobile(),this.addEventListenerStart()},this.addEventListenerStart=()=>{this.isMobile?(document.removeEventListener("mousedown",this.onMousedown),document.removeEventListener("mousemove",this.onMousemove),document.removeEventListener("mouseup",this.onMouseup),this.element.removeEventListener("mouseover",this.onElementMouseover),this.element.removeEventListener("mouseout",this.onElementMouseout),this.moveBtn.addEventListener("touchstart",this.onTouchstart,{passive:!0})):(document.removeEventListener("touchstart",this.onTouchstart),document.removeEventListener("touchmove",this.onTouchmove),document.removeEventListener("touchend",this.onTouchend),this.element.addEventListener("mouseover",this.onElementMouseover),this.element.addEventListener("mouseout",this.onElementMouseout),this.moveBtn.addEventListener("mousedown",this.onMousedown))},this.onElementMouseover=()=>{this.addKeyboardListeners(),this.showMoveBtn()},this.onElementMouseout=()=>{this.removeKeyboardListeners(),this.hideMovBtn()},this.onTouchstart=()=>{this.isDragging=!0,this.moveBtnSelect=!0,document.addEventListener("touchmove",this.onTouchmove,{passive:!0}),document.addEventListener("touchend",this.onTouchend)},this.onTouchmove=e=>{if(!(this.isDragging&&this.element&&this.moveBar&&this.moveBtn))return;let t=e.touches[0];this.setUserSelect("none"),this.updateMoveBarWidthAndMoveBtnLeft(this.horizontal?t.clientX:t.clientY)},this.onTouchend=()=>{document.removeEventListener("touchmove",this.onTouchmove),document.removeEventListener("touchend",this.onTouchend),this.isDragging=!1,this.moveBtnSelect=!1,this.setUserSelect("")},this.onMousedown=()=>{this.isDragging=!0,this.moveBtnSelect=!0,document.addEventListener("mousemove",this.onMousemove),document.addEventListener("mouseup",this.onMouseup)},this.onMouseup=()=>{document.removeEventListener("mousemove",this.onMousemove),document.removeEventListener("mouseup",this.onMouseup),this.isDragging=!1,this.moveBtnSelect=!1,this.hideMovBtn(),this.setUserSelect("")},this.onMousemove=e=>{this.isDragging&&this.element&&this.moveBar&&this.moveBtn&&(this.setUserSelect("none"),this.updateMoveBarWidthAndMoveBtnLeft(this.horizontal?e.clientX:e.clientY))},this.updateMoveBarWidthAndMoveBtnLeft=e=>{let t,i,s,o;this.horizontal?(t="left",i="width",s="width",o="right"):(t="top",i="height",s="height",o="top"),requestAnimationFrame((()=>{let n,h,r,d=this.element.getBoundingClientRect(),a=e-d[t],m=this.moveBtn.getBoundingClientRect(),l=d[i]*(this.options.step/100);this.horizontal?(h=Math.max(0,Math.min(a,d[i])),r=Math.min(100,h/d.width*100),n=0,h<m.width&&(n=-(m.width-+h.toFixed(0)))):(h=Math.round(Math.max(0,Math.min(d[i]-a,d[i]))/l)*l,r=h/d.height*100,n=0,a>=d.height-m.height&&(n=Math.max(-this.moveBtn.offsetWidth,h-this.moveBtn.offsetWidth))),this.moveBar.style[s]=r+"%",this.moveBtn.style[o]=n+"px",this.bindPositionChange()}))},this.setUserSelect=e=>{document.body.style.userSelect=e},!e)return void console.error(`Element is "${e}"`);this.element=e,this.options=Object.assign({},this.options,t),this.horizontal=this.options.horizontal;let i=e.getAttribute("data-dogProgress-horizontal");i&&("true"===i&&(this.horizontal=!0),"false"===i&&(this.horizontal=!1)),this.init()}}}));
//# sourceMappingURL=dogProgress-bar.umd.min.js.map
