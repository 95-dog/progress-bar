{"version":3,"file":"dogProgress-bar.min.js","sources":["../../src/js/dogProgress-bar.ts"],"sourcesContent":["/**\n *  ###########################################\n *\n * 注意事项：\n *\n * 如果设置了moveBar width的动画则会影响updateMoveBarWidthAndMoveBtnLeft方法\n *\n * 无法读取this.element.getBoundingClientRect()当前的值\n *\n * 因为此时浏览器还没有绘制完成 可使用setTimeout() 设置大于动画时间的延迟解决\n *\n * ############################################\n */\n\nconst ElementClass: string = 'dog-progress';\nconst MoveBarClass: string = 'move-bar';\nconst MoveBtnClass: string = 'move-btn';\n\nexport interface ProgressBarOptions {\n    height?: string,\n    width?: string,\n    moveBtnPercentage?: number,\n    moveBtnRadius?: string,\n    horizontal?: boolean,\n    step?: number\n    handleProgressChange?: HandleProgressChange,\n\n}\n\n\nclass DogProgressBar {\n    options: ProgressBarOptions = {\n        height: '10px',\n        width: '100%',\n        horizontal: true,\n        //0-1\n        moveBtnPercentage: 0,\n        moveBtnRadius: '15px',\n        //0-100\n        step: 1,\n        /**\n         * 当进度条发生改变时触发事件\n         *\n         * @param event\n         */\n        handleProgressChange: (event: ProgressCustomEvent) => {}\n    }\n    element: Element;\n    moveBar: HTMLElement;\n    moveBtn: HTMLElement;\n    isDragging: boolean = false;\n    horizontal: boolean;\n    moveBtnSelect: boolean = false;\n\n    /**\n     * 创建一个 ProgressBar 实例\n     * @param element\n     * @param options - 进度条的配置选项\n     * @return void\n     * @example\n     *    let progressBars = document.querySelectorAll('.volume-progress');\n     *     progressBars.forEach(item => new progressBar(item))\n     */\n    constructor(element: Element, options?: ProgressBarOptions) {\n        if (!element) {\n            console.error(`Element is \"${element}\"`);\n            return;\n        }\n        this.element = element;\n        this.options = Object.assign({}, this.options, options);\n        this.horizontal = this.options.horizontal;\n        let dataHorizontal: string = element.getAttribute('data-dogProgress-horizontal');\n        if (dataHorizontal) {\n            if (dataHorizontal === 'true') this.horizontal = true;\n            if (dataHorizontal === 'false') this.horizontal = false;\n        }\n        this.init();\n    }\n\n    /**\n     * 初始化Progress\n     */\n    init = () => {\n        this.element.classList.add(ElementClass);\n        if (!this.horizontal) {\n            this.element.classList.add('progress-vertical')\n        }\n\n        let _element: HTMLElement = this.element as HTMLElement;\n        _element.style.height = this.element.getAttribute('data-dogProgress-height') ?? this.options.height;\n        _element.style.width = this.element.getAttribute('data-dogProgress-width') ?? this.options.width;\n        _element.style.borderRadius = (this.element.clientHeight / 2) + 'px';\n        _element.addEventListener('click', (event: MouseEvent) => {\n            this.updateMoveBarWidthAndMoveBtnLeft(this.horizontal ? event.clientX : event.clientY);\n        })\n        this.buildMoveBar();\n        this.element.addEventListener('positionChange', this.options.handleProgressChange)\n        this.element.addEventListener('mouseover', (event: MouseEvent) => {\n            this.addKeyboardListeners();\n            this.showMoveBtn();\n        })\n        this.element.addEventListener('mouseout', (event: MouseEvent) => {\n            this.removeKeyboardListeners();\n            this.hideMovBtn();\n        })\n    }\n\n\n    /**\n     * 监听键盘事件\n     */\n    addKeyboardListeners = () => {\n        this.removeKeyboardListeners()\n        document.addEventListener('keydown', this.handleKeyboardNavigation)\n    }\n\n    /**\n     * 移除键盘事件\n     */\n    removeKeyboardListeners = () => {\n        document.removeEventListener('keydown', this.handleKeyboardNavigation);\n    }\n\n    /**\n     * 键盘事件处理\n     * @param event - KeyboardEvent\n     */\n    handleKeyboardNavigation = (event: KeyboardEvent) => {\n        let eleRect: DOMRect = this.element.getBoundingClientRect(),\n            moveBarRect: DOMRect = this.moveBar.getBoundingClientRect(),\n            stepValue: number, mouseCurrentValue: number;\n        if (this.horizontal) {\n            stepValue = (this.options.step / 100) * eleRect.width;\n            if (event.key === 'ArrowLeft') {\n                mouseCurrentValue = Math.max(0, moveBarRect.width - stepValue) + eleRect.left;\n                // this.moveBar.style.width = `${Math.max(0, (moveBarRect.width - stepValue)).toFixed(1)}px`;\n            }\n            if (event.key === 'ArrowRight') {\n                mouseCurrentValue = Math.min(eleRect.width, (moveBarRect.width + stepValue)) + eleRect.left;\n                // 处理向右键的逻辑\n                // this.moveBar.style.width = `${Math.min(eleRect.width, (moveBarRect.width + stepValue)).toFixed(1)}px`;\n            }\n            this.updateMoveBarWidthAndMoveBtnLeft(mouseCurrentValue)\n        } else {\n            stepValue = (this.options.step / 100) * eleRect.height\n            if (event.key === 'ArrowUp') {\n                mouseCurrentValue = eleRect.top + (eleRect.height - (moveBarRect.height + stepValue));\n            } else if (event.key === 'ArrowDown') {\n                mouseCurrentValue = eleRect.top + (eleRect.height - (moveBarRect.height - stepValue));\n            }\n            this.updateMoveBarWidthAndMoveBtnLeft(mouseCurrentValue)\n        }\n\n\n    }\n\n    /**\n     * 展示moveBtn按钮\n     */\n    showMoveBtn = () => {\n        this.moveBtn.style.visibility = 'unset';\n        this.moveBtn.style.opacity = '1';\n    }\n\n    /**\n     * 隐藏moveBtn按钮\n     */\n    hideMovBtn = () => {\n        if (this.moveBtnSelect) return;\n        this.moveBtn.style.visibility = 'hidden';\n        this.moveBtn.style.opacity = '0';\n    }\n\n\n    /**\n     * 绑定当bar发生变动时触发事件\n     */\n    bindPositionChange = () => {\n        let rectValue: keyof DOMRect = this.horizontal ? 'width' : 'height';\n        let changeEvent: ProgressCustomEvent = new CustomEvent('positionChange', {\n            detail: {\n                percentage: parseFloat((this.moveBar.getBoundingClientRect()[rectValue] /\n                    this.element.getBoundingClientRect()[rectValue]\n                ).toFixed(2)),\n            }\n        });\n        // 触发 change 事件\n        this.element.dispatchEvent(changeEvent);\n    }\n\n    /**\n     * 构建moveBar\n     */\n    buildMoveBar = () => {\n        let moveBar: HTMLElement = document.createElement('div'),\n            styleValue: any = this.horizontal ? 'width' : 'height',\n            percentageValue: number = +this.element.getAttribute('data-dogProgress-value') || this.options.moveBtnPercentage\n        moveBar.classList.add(MoveBarClass);\n        if (typeof percentageValue === 'number') {\n            if (percentageValue < 0 || percentageValue > 1) {\n                throw new Error('moveBtnPercentage的值为0-1之间');\n            }\n            moveBar.style[styleValue] = `${percentageValue * 100}%`;\n        }\n        moveBar.style.borderRadius = (this.element.clientHeight / 2) + 'px';\n        this.element.append(moveBar);\n        this.moveBar = moveBar;\n        this.buildMoveBtn();\n    }\n\n    /**\n     * 构建MoveBtn\n     */\n    buildMoveBtn = () => {\n        let moveBtn: HTMLElement = document.createElement('div'),\n            positionValue: any = this.horizontal ? 'right' : 'top';\n        moveBtn.classList.add(MoveBtnClass);\n        moveBtn.style.height = this.options.moveBtnRadius;\n        moveBtn.style.width = this.options.moveBtnRadius;\n        this.moveBar.append(moveBtn);\n        moveBtn.style[positionValue] = `-${moveBtn.offsetWidth / 2}px`;\n        this.moveBtn = moveBtn;\n        this.moveBtn.addEventListener('mousedown', () => {\n            this.isDragging = true;\n            this.moveBtnSelect = true;\n            document.addEventListener('mousemove', this.onMousemove)\n            document.addEventListener('mouseup', this.onMouseup)\n        })\n    }\n\n    /**\n     * 鼠标按下事件\n     * @param event - mouseEvent\n     */\n    onMouseup = (event: MouseEvent) => {\n        document.removeEventListener('mousemove', this.onMousemove);\n        document.removeEventListener('mouseup', this.onMouseup)\n        this.isDragging = false;\n        this.moveBtnSelect = false;\n        this.hideMovBtn();\n        this.setUserSelect('');\n    }\n\n    /**\n     * 鼠标移动事件\n     * @param event - MouseEvent\n     */\n    onMousemove = (event: MouseEvent) => {\n        if (!this.isDragging || !this.element || !this.moveBar || !this.moveBtn) return;\n        this.setUserSelect('none');\n        this.updateMoveBarWidthAndMoveBtnLeft(this.horizontal ? event.clientX : event.clientY)\n    }\n\n    /**\n     * 更新moveBar和moveBarBtn的位置\n     * @param client - number\n     */\n    updateMoveBarWidthAndMoveBtnLeft = (client: number) => {\n        let eleRectValue: keyof DOMRect, eleRectStyleValue: keyof DOMRect, barValue: any, btnValue: any;\n        if (this.horizontal) {\n            eleRectValue = 'left';\n            eleRectStyleValue = 'width';\n            barValue = 'width';\n            btnValue = 'right';\n        } else {\n            eleRectValue = 'top';\n            eleRectStyleValue = 'height';\n            barValue = 'height';\n            btnValue = 'top';\n        }\n\n\n        requestAnimationFrame(() => {\n            let eleRect: DOMRect = this.element.getBoundingClientRect(),\n                mousePosition: number = client - eleRect[eleRectValue],\n                btnPosition: number, barPosition: number,\n                barPercentage: number, btnPercentage: number;\n            let stepSize: number = eleRect[eleRectStyleValue] * (this.options.step / 100);\n            if (this.horizontal) {\n                barPosition = Math.max(0, Math.min(mousePosition, eleRect[eleRectStyleValue]));\n                barPercentage = Math.min(100, (barPosition / eleRect.width) * 100);\n                btnPosition = 0;\n                if (barPosition < this.moveBtn.getBoundingClientRect().width) {\n                    btnPosition = -(this.moveBtn.getBoundingClientRect().width - (+barPosition.toFixed(0)));\n                }\n            } else {\n                barPosition = Math.round(Math.max(0, Math.min(eleRect[eleRectStyleValue] - mousePosition, eleRect[eleRectStyleValue])) / stepSize) * stepSize;\n                barPercentage = (barPosition / eleRect.height) * 100;\n                btnPosition = 0;\n                if (mousePosition >= eleRect.height - this.moveBtn.getBoundingClientRect().height) {\n                    btnPosition = Math.max(-this.moveBtn.offsetWidth, barPosition - this.moveBtn.offsetWidth);\n                }\n            }\n            this.moveBar.style[barValue] = barPercentage + '%';\n            this.moveBtn.style[btnValue] = btnPosition + 'px';\n            this.bindPositionChange();\n        })\n    }\n\n    /**\n     * 设置用户选中避免拖动突出触发选中\n     * @param value - string\n     */\n    setUserSelect = (value: string) => {\n        document.body.style.userSelect = value;\n    }\n}\n\n\ntype ProgressEvent = {\n    percentage: number\n}\nexport type ProgressCustomEvent = CustomEvent<ProgressEvent>;\n\ntype HandleProgressChange = (event: ProgressCustomEvent) => void;\n\nexport default DogProgressBar;\n"],"names":["constructor","element","options","this","height","width","horizontal","moveBtnPercentage","moveBtnRadius","step","handleProgressChange","event","isDragging","moveBtnSelect","init","classList","add","_element","style","getAttribute","borderRadius","clientHeight","addEventListener","updateMoveBarWidthAndMoveBtnLeft","clientX","clientY","buildMoveBar","addKeyboardListeners","showMoveBtn","removeKeyboardListeners","hideMovBtn","document","handleKeyboardNavigation","removeEventListener","stepValue","mouseCurrentValue","eleRect","getBoundingClientRect","moveBarRect","moveBar","key","Math","max","left","min","top","moveBtn","visibility","opacity","bindPositionChange","rectValue","changeEvent","CustomEvent","detail","percentage","parseFloat","toFixed","dispatchEvent","createElement","styleValue","percentageValue","Error","append","buildMoveBtn","positionValue","offsetWidth","onMousemove","onMouseup","setUserSelect","client","eleRectValue","eleRectStyleValue","barValue","btnValue","requestAnimationFrame","btnPosition","barPosition","barPercentage","mousePosition","stepSize","round","value","body","userSelect","console","error","Object","assign","dataHorizontal"],"mappings":"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"}