class t{constructor(t,e){if(this.options={height:"10px",width:"100%",horizontal:!0,moveBtnPercentage:0,moveBtnRadius:"15px",step:1,handleProgressChange:t=>{}},this.isDragging=!1,this.moveBtnSelect=!1,this.init=()=>{this.element.classList.add("dog-progress"),this.horizontal||this.element.classList.add("progress-vertical");let t=this.element;t.style.height=this.element.getAttribute("data-dogProgress-height")??this.options.height,t.style.width=this.element.getAttribute("data-dogProgress-width")??this.options.width,t.style.borderRadius=this.element.clientHeight/2+"px",t.addEventListener("click",(t=>{this.updateMoveBarWidthAndMoveBtnLeft(this.horizontal?t.clientX:t.clientY)})),this.buildMoveBar(),this.element.addEventListener("positionChange",this.options.handleProgressChange),this.element.addEventListener("mouseover",(t=>{this.addKeyboardListeners(),this.showMoveBtn()})),this.element.addEventListener("mouseout",(t=>{this.removeKeyboardListeners(),this.hideMovBtn()}))},this.addKeyboardListeners=()=>{this.removeKeyboardListeners(),document.addEventListener("keydown",this.handleKeyboardNavigation)},this.removeKeyboardListeners=()=>{document.removeEventListener("keydown",this.handleKeyboardNavigation)},this.handleKeyboardNavigation=t=>{let e,i,s=this.element.getBoundingClientRect(),o=this.moveBar.getBoundingClientRect();this.horizontal?(e=this.options.step/100*s.width,"ArrowLeft"===t.key&&(i=Math.max(0,o.width-e)+s.left),"ArrowRight"===t.key&&(i=Math.min(s.width,o.width+e)+s.left),this.updateMoveBarWidthAndMoveBtnLeft(i)):(e=this.options.step/100*s.height,"ArrowUp"===t.key?i=s.top+(s.height-(o.height+e)):"ArrowDown"===t.key&&(i=s.top+(s.height-(o.height-e))),this.updateMoveBarWidthAndMoveBtnLeft(i))},this.showMoveBtn=()=>{this.moveBtn.style.visibility="unset",this.moveBtn.style.opacity="1"},this.hideMovBtn=()=>{this.moveBtnSelect||(this.moveBtn.style.visibility="hidden",this.moveBtn.style.opacity="0")},this.bindPositionChange=()=>{let t=this.horizontal?"width":"height",e=new CustomEvent("positionChange",{detail:{percentage:parseFloat((this.moveBar.getBoundingClientRect()[t]/this.element.getBoundingClientRect()[t]).toFixed(2))}});this.element.dispatchEvent(e)},this.buildMoveBar=()=>{let t=document.createElement("div"),e=this.horizontal?"width":"height",i=+this.element.getAttribute("data-dogProgress-value")||this.options.moveBtnPercentage;if(t.classList.add("move-bar"),"number"==typeof i){if(i<0||i>1)throw new Error("moveBtnPercentage的值为0-1之间");t.style[e]=100*i+"%"}t.style.borderRadius=this.element.clientHeight/2+"px",this.element.append(t),this.moveBar=t,this.buildMoveBtn()},this.buildMoveBtn=()=>{let t=document.createElement("div"),e=this.horizontal?"right":"top";t.classList.add("move-btn"),t.style.height=this.options.moveBtnRadius,t.style.width=this.options.moveBtnRadius,this.moveBar.append(t),t.style[e]=`-${t.offsetWidth/2}px`,this.moveBtn=t,this.moveBtn.addEventListener("mousedown",(()=>{this.isDragging=!0,this.moveBtnSelect=!0,document.addEventListener("mousemove",this.onMousemove),document.addEventListener("mouseup",this.onMouseup)}))},this.onMouseup=t=>{document.removeEventListener("mousemove",this.onMousemove),document.removeEventListener("mouseup",this.onMouseup),this.isDragging=!1,this.moveBtnSelect=!1,this.hideMovBtn(),this.setUserSelect("")},this.onMousemove=t=>{this.isDragging&&this.element&&this.moveBar&&this.moveBtn&&(this.setUserSelect("none"),this.updateMoveBarWidthAndMoveBtnLeft(this.horizontal?t.clientX:t.clientY))},this.updateMoveBarWidthAndMoveBtnLeft=t=>{let e,i,s,o;this.horizontal?(e="left",i="width",s="width",o="right"):(e="top",i="height",s="height",o="top"),requestAnimationFrame((()=>{let n,h,d,a=this.element.getBoundingClientRect(),r=t-a[e],l=a[i]*(this.options.step/100);this.horizontal?(h=Math.max(0,Math.min(r,a[i])),d=Math.min(100,h/a.width*100),n=0,h<this.moveBtn.getBoundingClientRect().width&&(n=-(this.moveBtn.getBoundingClientRect().width-+h.toFixed(0)))):(h=Math.round(Math.max(0,Math.min(a[i]-r,a[i]))/l)*l,d=h/a.height*100,n=0,r>=a.height-this.moveBtn.getBoundingClientRect().height&&(n=Math.max(-this.moveBtn.offsetWidth,h-this.moveBtn.offsetWidth))),this.moveBar.style[s]=d+"%",this.moveBtn.style[o]=n+"px",this.bindPositionChange()}))},this.setUserSelect=t=>{document.body.style.userSelect=t},!t)return void console.error(`Element is "${t}"`);this.element=t,this.options=Object.assign({},this.options,e),this.horizontal=this.options.horizontal;let i=t.getAttribute("data-dogProgress-horizontal");i&&("true"===i&&(this.horizontal=!0),"false"===i&&(this.horizontal=!1)),this.init()}}export{t as default};
//# sourceMappingURL=dogProgress-bar.esm.min.js.map
